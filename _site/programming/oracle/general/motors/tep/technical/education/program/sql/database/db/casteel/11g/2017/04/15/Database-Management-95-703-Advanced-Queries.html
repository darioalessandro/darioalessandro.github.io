<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Database Management 95-703 - Advanced queries</title>
  <meta name="description" content="Outline">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/programming/oracle/general/motors/tep/technical/education/program/sql/database/db/casteel/11g/2017/04/15/Database-Management-95-703-Advanced-Queries.html">
  <link rel="alternate" type="application/rss+xml" title="Dario Alessandro Lencina-Talarico" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="/">Dario Alessandro Lencina-Talarico</a>

    <nav class="site-nav">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </span>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Database Management 95-703 - Advanced queries</h1>
    <p class="post-meta"><time datetime="2017-04-15T11:00:00-04:00" itemprop="datePublished">Apr 15, 2017</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="outline">Outline</h2>

<ul>
  <li>
    <p>Extension to <strong>GROUP BY</strong> clause:</p>

    <ul>
      <li>GROUPING SETS,</li>
      <li>ROLLUP</li>
      <li>CUBE</li>
    </ul>
  </li>
  <li>
    <p>DECODE function and CASE expressions</p>
  </li>
  <li>
    <p>Pivoting a table</p>
  </li>
  <li>
    <p>Hierarchical Queries</p>
  </li>
</ul>

<h2 id="extensions-to-group-by">Extensions to <strong>GROUP BY</strong></h2>

<p><strong>GROUPING SETS ** - defines criteria for several **GROUP BY</strong> aggregations.</p>

<h2 id="combining-grouping-results">Combining “grouping” results</h2>

<p>List publisher’s name, book category, number of books published and average book price:</p>

<ul>
  <li>For each category</li>
  <li>For each publisher and</li>
  <li>For each publisher within each category</li>
</ul>

<p>Then add the total number of books and average book price for all books. Include all four result sets in one list.</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="mi">1</span><span class="p">)</span>      <span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">isbn</span><span class="p">),</span> <span class="k">AVG</span><span class="p">(</span><span class="n">retail</span><span class="p">)</span>
        <span class="k">FROM</span> <span class="n">publisher</span> <span class="k">JOIN</span> <span class="n">books</span> <span class="k">USING</span> <span class="p">(</span><span class="n">pubid</span><span class="p">)</span>
        <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">name</span><span class="p">,</span> <span class="n">category</span>
        <span class="k">UNION</span> <span class="k">ALL</span>
<span class="mi">2</span><span class="p">)</span>      <span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">isbn</span><span class="p">),</span> <span class="k">AVG</span><span class="p">(</span><span class="n">retail</span><span class="p">)</span>
        <span class="k">FROM</span> <span class="n">publisher</span> <span class="k">JOIN</span> <span class="n">books</span> <span class="k">USING</span> <span class="p">(</span><span class="n">pubid</span><span class="p">)</span>
        <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">name</span>
        <span class="k">UNION</span> <span class="k">ALL</span>
<span class="mi">3</span><span class="p">)</span>      <span class="k">SELECT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">isbn</span><span class="p">),</span> <span class="k">AVG</span><span class="p">(</span><span class="n">retail</span><span class="p">)</span>
        <span class="k">FROM</span> <span class="n">books</span>
        <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">category</span>
        <span class="k">UNION</span> <span class="k">ALL</span>
<span class="mi">4</span><span class="p">)</span>      <span class="k">SELECT</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">isbn</span><span class="p">),</span> <span class="k">AVG</span><span class="p">(</span><span class="n">retail</span><span class="p">)</span>
        <span class="k">FROM</span> <span class="n">books</span>
        <span class="k">GROUP</span> <span class="k">BY</span> <span class="p">();</span>
</code></pre>
</div>

<p>Same query in 4 lines:</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span>  <span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">isbn</span><span class="p">),</span> <span class="k">AVG</span><span class="p">(</span><span class="n">retail</span><span class="p">)</span>
<span class="k">FROM</span>    <span class="n">publisher</span> <span class="k">JOIN</span> <span class="n">books</span> <span class="k">USING</span> <span class="p">(</span><span class="n">pubid</span><span class="p">)</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span>
            <span class="p">((</span><span class="n">name</span><span class="p">,</span><span class="n">category</span><span class="p">),</span> <span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="p">());</span>
</code></pre>
</div>

<h2 id="rollup-extension">ROLLUP extension</h2>

<p>For each region and state provide number of orders and the total profit generated from sales. Provide the aggregated
values for each region, then for each state within the region. Also provide the total number of orders and overall profit.</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">region</span> <span class="nv">"Region"</span><span class="p">,</span> <span class="k">state</span> <span class="nv">"State"</span><span class="p">,</span> <span class="k">COUNT</span> <span class="p">(</span><span class="k">DISTINCT</span> <span class="k">order</span><span class="o">#</span><span class="p">)</span> <span class="nv">"# orders"</span><span class="p">,</span>
                <span class="n">TO_CHAR</span><span class="p">(</span><span class="k">SUM</span><span class="p">((</span><span class="n">paideach</span><span class="o">-</span><span class="n">cost</span><span class="p">)</span> <span class="o">*</span> <span class="n">quantity</span><span class="p">),</span> <span class="s1">'$9990.99'</span><span class="p">)</span>
                <span class="k">AS</span> <span class="nv">"Profit"</span>
<span class="k">FROM</span> <span class="n">books</span>  <span class="k">JOIN</span> <span class="n">orderitems</span> <span class="k">USING</span> <span class="p">(</span><span class="n">isbn</span><span class="p">)</span>
            <span class="k">JOIN</span> <span class="n">orders</span>     <span class="k">USING</span> <span class="p">(</span><span class="k">order</span><span class="o">#</span><span class="p">)</span>
            <span class="k">JOIN</span> <span class="n">customers</span>  <span class="k">USING</span> <span class="p">(</span><span class="n">customer</span><span class="o">#</span><span class="p">)</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">ROLLUP</span> <span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="k">state</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span>

<span class="n">Region</span>  <span class="k">State</span>   <span class="o">#</span> <span class="n">orders</span>    <span class="n">Profit</span>
<span class="c1">--------------------------------------</span>
<span class="n">N</span>       <span class="n">IL</span>      <span class="mi">1</span>           <span class="err">$</span><span class="mi">49</span><span class="p">.</span><span class="mi">10</span>
<span class="n">N</span>       <span class="n">MI</span>      <span class="mi">1</span>           <span class="err">$</span><span class="mi">55</span><span class="p">.</span><span class="mi">28</span>
<span class="n">N</span>       <span class="n">WY</span>      <span class="mi">2</span>           <span class="err">$</span><span class="mi">32</span><span class="p">.</span><span class="mi">00</span>
<span class="n">N</span>               <span class="mi">4</span>           <span class="err">$</span><span class="mi">136</span><span class="p">.</span><span class="mi">38</span>
<span class="n">NE</span>      <span class="n">NJ</span>      <span class="mi">3</span>           <span class="err">$</span><span class="mi">106</span><span class="p">.</span><span class="mi">90</span>
<span class="n">NE</span>              <span class="mi">3</span>           <span class="err">$</span><span class="mi">106</span><span class="p">.</span><span class="mi">90</span>
<span class="n">NW</span>      <span class="n">ID</span>      <span class="mi">1</span>           <span class="err">$</span><span class="mi">14</span><span class="p">.</span><span class="mi">90</span>
<span class="n">NW</span>      <span class="n">WA</span>      <span class="mi">2</span>           <span class="err">$</span><span class="mi">22</span><span class="p">.</span><span class="mi">90</span>
<span class="n">NW</span>              <span class="mi">3</span>           <span class="err">$</span><span class="mi">37</span><span class="p">.</span><span class="mi">60</span>
<span class="p">....</span>
                <span class="mi">21</span>          <span class="err">$</span><span class="mi">670</span><span class="p">.</span><span class="mi">82</span>
</code></pre>
</div>

<p>In this example, 3 levels of increasing aggregation are performed:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1. Number of orders (and the total profit) for each combination of Region and State columns.

2. Number of orders (and the total profit) only for each Region.

3. "Grand total" of the number of orders and the profit generated from sales.
</code></pre>
</div>

<h2 id="cube-extensions">CUBE extensions</h2>

<p>For each order, publisher and category, list publisher’s name, category, month of the order (month and year together),
number of books ordered, and the average price for for each of the groups identified by the order, publisher and category.</p>

<p>Provide aggregated values (i.e. number of books and the average price) for combination of all 3 “columns”, for any two
“columns”, any single “column” and grand totals.</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span>  <span class="n">name</span><span class="p">,</span> <span class="n">category</span>
        <span class="n">TO_CHAR</span><span class="p">(</span><span class="n">orderdate</span><span class="p">,</span> <span class="s1">'MM-YYYY'</span><span class="p">)</span> <span class="k">Month</span><span class="p">,</span>
        <span class="k">COUNT</span><span class="p">(</span><span class="n">isbn</span><span class="p">)</span> <span class="nv">"#"</span><span class="p">,</span>
        <span class="n">TO_CHAR</span><span class="p">(</span><span class="k">AVG</span><span class="p">(</span><span class="n">retail</span><span class="p">),</span> <span class="s1">'$90.99'</span><span class="p">)</span> <span class="nv">"AVG Retail"</span>
<span class="k">FROM</span>    <span class="n">publisher</span>   <span class="k">JOIN</span>    <span class="n">books</span>       <span class="k">USING</span> <span class="p">(</span><span class="n">pubid</span><span class="p">)</span>
                    <span class="k">JOIN</span>    <span class="n">orderitems</span>  <span class="k">USING</span> <span class="p">(</span><span class="n">isbn</span><span class="p">)</span>
                    <span class="k">JOIN</span>    <span class="n">orders</span>      <span class="k">USING</span> <span class="p">(</span><span class="k">order</span><span class="o">#</span><span class="p">)</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">CUBE</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">TO_CHAR</span><span class="p">(</span><span class="n">orderdate</span><span class="p">,</span><span class="s1">'MM-YYYY'</span><span class="p">))</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="k">Month</span><span class="p">;</span>
</code></pre>
</div>

<h2 id="grouping-date---equivalent-statements">Grouping date - equivalent statements</h2>

<p>Equivalence of ROLLUP/CUBE and GROUPING SETS</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">ROLLUP</span><span class="o">/</span><span class="k">CUBE</span> <span class="k">option</span>      <span class="n">Equivalent</span> <span class="k">GROUPING</span> <span class="k">SET</span> <span class="k">option</span>

<span class="k">GROUP</span> <span class="k">BY</span>                <span class="k">GROUP</span> <span class="k">BY</span>
    <span class="k">ROLLUP</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">)</span>       <span class="k">GROUPING</span> <span class="k">SETS</span>
                        <span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="p">())</span>

<span class="k">GROUP</span> <span class="k">BY</span>                <span class="k">GROUP</span> <span class="k">BY</span>
    <span class="k">CUBE</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">)</span>         <span class="k">GROUPING</span> <span class="k">SETS</span>
                        <span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="k">c</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="k">c</span><span class="p">,</span> <span class="p">())</span>

</code></pre>
</div>

<p>Equivalence of GROUPING SETS and GROUP BY statements</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">GROUPING</span> <span class="k">SETS</span> <span class="k">option</span>                <span class="n">Equivalent</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">clause</span>

<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">)</span>      <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span> <span class="p">...</span> <span class="k">UNION</span> <span class="k">ALL</span>
                                    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">b</span> <span class="p">...</span> <span class="k">UNION</span> <span class="k">ALL</span>
                                    <span class="k">GROUP</span> <span class="k">BY</span> <span class="k">c</span>

<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,())</span>     <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span> <span class="p">...</span> <span class="k">UNION</span> <span class="k">ALL</span>
                                    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">b</span> <span class="p">...</span> <span class="k">UNION</span> <span class="k">ALL</span>
                                    <span class="k">GROUP</span> <span class="k">BY</span> <span class="p">()</span>

<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,(</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">((</span>   <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span> <span class="p">...</span> <span class="k">UNION</span> <span class="k">ALL</span>
                                    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">b</span> <span class="p">...</span> <span class="k">UNION</span> <span class="k">ALL</span>
                                    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">b</span><span class="p">,</span> <span class="k">c</span>

<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">))</span>     <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="k">c</span>

<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span><span class="p">(</span><span class="n">a</span><span class="p">,</span>           <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span>      <span class="p">...</span> <span class="k">UNION</span> <span class="k">ALL</span>
                     <span class="k">ROLLUP</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">))</span>   <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">b</span><span class="p">,</span> <span class="k">c</span>   <span class="p">...</span> <span class="k">UNION</span> <span class="k">ALL</span>
                                    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">b</span>      <span class="p">...</span> <span class="k">UNION</span> <span class="k">ALL</span>
                                    <span class="k">GROUP</span> <span class="k">BY</span> <span class="p">()</span>
</code></pre>
</div>

<h2 id="decode-function">DECODE function</h2>

<p>DECODE(c,v1,r1,v2,r2,…,[d])</p>

<p>c - input
v1 - first value
r1 - result to be returned if c and v1 are equivalent
d - default value</p>

<h1 id="example">Example:</h1>

<p>JustLee Books is required to collect taxes from customers living in Florida or California but not from customers residing
in other states. Create a column with the tax rate for the two states.</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span>  <span class="n">customer</span><span class="o">#</span><span class="p">,</span> <span class="k">state</span><span class="p">,</span> <span class="n">DECODE</span><span class="p">(</span><span class="k">state</span><span class="p">,</span>  <span class="s1">'CA'</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">09</span><span class="p">,</span>
                                        <span class="s1">'FL'</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">07</span><span class="p">,</span>
                                                 <span class="mi">0</span><span class="p">)</span> <span class="nv">"Sales Tax Rate"</span>
<span class="k">FROM</span>    <span class="n">customers</span><span class="p">;</span>

<span class="n">CUSTOMER</span><span class="o">#</span>   <span class="n">ST</span>    <span class="n">Sales</span> <span class="n">Tax</span> <span class="n">Rate</span>
<span class="c1">------------------------------------</span>
<span class="mi">1015</span>        <span class="n">FL</span>              <span class="p">.</span><span class="mi">07</span>
<span class="mi">1019</span>        <span class="n">NJ</span>                <span class="mi">0</span>
<span class="p">...</span>
<span class="mi">1016</span>        <span class="n">CA</span>              <span class="p">.</span><span class="mi">09</span>
</code></pre>
</div>

<h2 id="case-expressions">CASE expressions</h2>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span>  <span class="n">customer</span><span class="o">#</span><span class="p">,</span> <span class="k">state</span><span class="p">,</span>
        <span class="k">CASE</span>    <span class="k">state</span>
                <span class="k">WHEN</span> <span class="s1">'CA'</span> <span class="k">THEN</span> <span class="mi">0</span><span class="p">.</span><span class="mi">09</span>
                <span class="k">WHEN</span> <span class="s1">'FL'</span> <span class="k">THEN</span> <span class="mi">0</span><span class="p">.</span><span class="mi">07</span>
                <span class="k">ELSE</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>
        <span class="k">END</span> <span class="k">AS</span> <span class="nv">"Sales Tax Rate"</span>
<span class="k">FROM</span>    <span class="n">customers</span><span class="p">;</span>
</code></pre>
</div>

<h2 id="search-case-expressions">Search CASE expressions</h2>

<p>Assume that a book is cheap when the retail price is less than $30. Determine which book is check and which is expensive.</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span>      <span class="n">title</span><span class="p">,</span> <span class="n">retail</span><span class="p">,</span>
            <span class="k">CASE</span>
                <span class="k">WHEN</span> <span class="n">retail</span> <span class="o">&lt;</span> <span class="mi">30</span>    <span class="k">THEN</span> <span class="s1">'Cheap'</span>
                <span class="k">ELSE</span> <span class="s1">'Expensive'</span>
            <span class="k">END</span> <span class="nv">"Is it cheap?"</span>
<span class="k">FROM</span>        <span class="n">books</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">retail</span><span class="p">;</span>

<span class="n">TITLE</span>                   <span class="n">RETAIL</span>      <span class="k">Is</span> <span class="n">it</span> <span class="n">cheap</span><span class="o">?</span>
<span class="c1">-------------------------------------------------</span>
</code></pre>
</div>

<h2 id="pivot-table-with-totals">Pivot table with “Totals”</h2>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">DECODE</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="s1">'Publisher Total'</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span> <span class="nv">"Category"</span><span class="p">,</span>
       <span class="k">SUM</span><span class="p">(</span><span class="n">DECODE</span><span class="p">(</span><span class="n">pubID</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">"#1"</span><span class="p">,</span>
       <span class="k">SUM</span><span class="p">(</span><span class="n">DECODE</span><span class="p">(</span><span class="n">pubID</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">"#2"</span><span class="p">,</span>
       <span class="k">SUM</span><span class="p">(</span><span class="n">DECODE</span><span class="p">(</span><span class="n">pubID</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">"#3"</span><span class="p">,</span>
       <span class="k">SUM</span><span class="p">(</span><span class="n">DECODE</span><span class="p">(</span><span class="n">pubID</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">"#4"</span><span class="p">,</span>
       <span class="k">SUM</span><span class="p">(</span><span class="n">DECODE</span><span class="p">(</span><span class="n">pubID</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">"#5"</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="n">isbn</span><span class="p">)</span> <span class="nv">"Category Total"</span>
<span class="k">FROM</span>   <span class="n">books</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">())</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">category</span><span class="p">;</span>

<span class="n">Category</span>        <span class="o">#</span><span class="mi">1</span>  <span class="o">#</span><span class="mi">2</span>  <span class="o">#</span><span class="mi">3</span>  <span class="o">#</span><span class="mi">4</span>  <span class="o">#</span><span class="mi">5</span>  <span class="n">Category</span> <span class="n">Total</span>
<span class="c1">---------------------------------------------------</span>
<span class="n">BUSINESS</span>        <span class="mi">1</span>                               <span class="mi">1</span>
<span class="n">CHILDREN</span>            <span class="mi">1</span>           <span class="mi">1</span>               <span class="mi">2</span>
<span class="p">....</span>
<span class="k">SELF</span> <span class="n">HELP</span>                   <span class="mi">1</span>                   <span class="mi">1</span>
<span class="n">Publisher</span> <span class="n">Total</span> <span class="mi">2</span>   <span class="mi">2</span>   <span class="mi">3</span>   <span class="mi">4</span>   <span class="mi">3</span>               <span class="mi">14</span>
</code></pre>
</div>

<h1 id="replacing-null-values">Replacing NULL Values</h1>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">DECODE</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="s1">'Publisher Total'</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span> <span class="nv">"Category"</span><span class="p">,</span>
       <span class="k">SUM</span><span class="p">(</span><span class="n">DECODE</span><span class="p">(</span><span class="n">pubID</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="nv">"#1"</span><span class="p">,</span>
       <span class="k">SUM</span><span class="p">(</span><span class="n">DECODE</span><span class="p">(</span><span class="n">pubID</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="nv">"#2"</span><span class="p">,</span>
       <span class="k">SUM</span><span class="p">(</span><span class="n">DECODE</span><span class="p">(</span><span class="n">pubID</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="nv">"#3"</span><span class="p">,</span>
       <span class="k">SUM</span><span class="p">(</span><span class="n">DECODE</span><span class="p">(</span><span class="n">pubID</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="nv">"#4"</span><span class="p">,</span>
       <span class="k">SUM</span><span class="p">(</span><span class="n">DECODE</span><span class="p">(</span><span class="n">pubID</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="nv">"#5"</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="n">isbn</span><span class="p">)</span> <span class="nv">"Category Total"</span>
<span class="k">FROM</span>   <span class="n">books</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">())</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">category</span><span class="p">;</span>

<span class="n">Category</span>        <span class="o">#</span><span class="mi">1</span>  <span class="o">#</span><span class="mi">2</span>  <span class="o">#</span><span class="mi">3</span>  <span class="o">#</span><span class="mi">4</span>  <span class="o">#</span><span class="mi">5</span>  <span class="n">Category</span> <span class="n">Total</span>
<span class="c1">---------------------------------------------------</span>
</code></pre>
</div>

<p><strong>SELECTIVITY</strong> number of unique values in a column</p>

<p>Is column has low selectivity, it is a candidate to be turned into columns</p>

<h2 id="hierarchical-queries">Hierarchical Queries</h2>

<p>Special queries called hierarchical queries have a mechanism to recognize and represent trees.</p>

<p>recursive “One-to-Many” relationship that forms a tree structure.</p>

<h1 id="complete-tree-structure">Complete tree structure</h1>

<p>Build organizational chart</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span>      <span class="n">employee_ID</span><span class="p">,</span> <span class="n">manager_ID</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">department_id</span>
<span class="k">FROM</span>        <span class="n">employee2</span>
<span class="k">START</span> <span class="k">WITH</span>  <span class="n">employee_ID</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">CONNECT</span> <span class="k">BY</span> <span class="k">PRIOR</span> <span class="n">employee_ID</span> <span class="o">=</span> <span class="n">manager_ID</span><span class="p">;</span>
</code></pre>
</div>

<h1 id="pseudo-column-level">Pseudo column LEVEL</h1>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">LEVEL</span>
    <span class="n">LPAD</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="k">LEVEL</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">||</span> <span class="n">employee_ID</span> <span class="o">||</span> <span class="s1">'    '</span> <span class="o">||</span> <span class="n">first_name</span> <span class="o">||</span> <span class="s1">' '</span>
    <span class="o">||</span> <span class="n">last_name</span> <span class="nv">"Employee"</span><span class="p">,</span> <span class="n">department_id</span>
    <span class="k">FROM</span> <span class="n">employee2</span>
    <span class="k">START</span> <span class="k">WITH</span> <span class="n">employee_ID</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">CONNECT</span> <span class="k">BY</span> <span class="k">PRIOR</span> <span class="n">employee_ID</span> <span class="o">=</span> <span class="n">manager_ID</span><span class="p">;</span>

<span class="k">LEVEL</span>       <span class="n">Employee</span>                                            <span class="n">DEPARTMENT_ID</span>
<span class="c1">-----------------------------------------------------------------------------</span>
<span class="mi">1</span>       <span class="mi">100</span> <span class="n">Steven</span> <span class="n">King</span>                                                 <span class="mi">90</span>
<span class="mi">2</span>           <span class="mi">101</span> <span class="n">Neena</span> <span class="n">Kochhar</span>                                           <span class="mi">90</span>
<span class="mi">3</span>               <span class="mi">108</span> <span class="n">Nancy</span> <span class="n">Greenberg</span>                                    <span class="mi">100</span>
<span class="mi">4</span>                   <span class="mi">109</span> <span class="n">Daniel</span> <span class="n">Fav</span>                                     <span class="mi">100</span>
<span class="mi">4</span>                   <span class="mi">110</span> <span class="n">John</span> <span class="n">Chen</span>                                      <span class="mi">100</span>
<span class="mi">4</span>                   <span class="mi">111</span> <span class="n">Ismael</span> <span class="p">..</span>                                      <span class="mi">100</span>
<span class="mi">4</span>                   <span class="mi">112</span> <span class="n">Jose</span> <span class="p">..</span>                                        <span class="mi">100</span>
<span class="mi">4</span>                   <span class="mi">113</span> <span class="n">Luis</span> <span class="p">.,</span>                                        <span class="mi">100</span>
<span class="mi">3</span>               <span class="mi">205</span> <span class="n">Shelly</span> <span class="p">..</span>                                          <span class="mi">110</span>
</code></pre>
</div>
<h1 id="showing-more-than-one-sub-tree">Showing more than one sub-tree</h1>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">LEVEL</span>
    <span class="n">LPAD</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="k">LEVEL</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">||</span> <span class="n">employee_ID</span> <span class="o">||</span> <span class="s1">'    '</span> <span class="o">||</span> <span class="n">first_name</span> <span class="o">||</span> <span class="s1">' '</span>
    <span class="o">||</span> <span class="n">last_name</span> <span class="nv">"Employee"</span><span class="p">,</span> <span class="n">department_id</span>
    <span class="k">FROM</span> <span class="n">employee2</span>
    <span class="k">START</span> <span class="k">WITH</span> <span class="n">employee_ID</span> <span class="o">=</span> <span class="mi">101</span> <span class="k">OR</span> <span class="n">employee_ID</span> <span class="o">=</span> <span class="mi">102</span>
    <span class="k">CONNECT</span> <span class="k">BY</span> <span class="k">PRIOR</span> <span class="n">employee_ID</span> <span class="o">=</span> <span class="n">manager_ID</span><span class="p">;</span>
</code></pre>
</div>

<h1 id="traversing-the-tree-upward">Traversing the tree upward</h1>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">LEVEL</span>
    <span class="n">LPAD</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="k">LEVEL</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">||</span> <span class="n">employee_ID</span> <span class="o">||</span> <span class="s1">'    '</span> <span class="o">||</span> <span class="n">first_name</span> <span class="o">||</span> <span class="s1">' '</span>
    <span class="o">||</span> <span class="n">last_name</span> <span class="nv">"Employee"</span><span class="p">,</span> <span class="n">department_id</span>
    <span class="k">FROM</span> <span class="n">employee2</span>
    <span class="k">START</span> <span class="k">WITH</span> <span class="n">employee_ID</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">206</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
    <span class="k">CONNECT</span> <span class="k">BY</span> <span class="k">PRIOR</span> <span class="n">manager_ID</span> <span class="o">=</span> <span class="n">employee_ID</span><span class="p">;</span>
</code></pre>
</div>

<h1 id="pruning-sub-tree">Pruning sub-tree</h1>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span>      <span class="n">employee_ID</span><span class="p">,</span> <span class="n">manager_ID</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">department_id</span>
<span class="k">FROM</span>        <span class="n">employee2</span>
<span class="k">START</span> <span class="k">WITH</span>  <span class="n">employee_ID</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">CONNECT</span> <span class="k">BY</span> <span class="k">PRIOR</span> <span class="n">employee_ID</span> <span class="o">=</span> <span class="n">manager_ID</span><span class="p">;</span>
<span class="k">AND</span> <span class="p">(</span><span class="n">employee_ID</span> <span class="o">!=</span> <span class="mi">103</span> <span class="k">AND</span> <span class="n">employee_ID</span> <span class="o">!=</span> <span class="mi">205</span><span class="p">);</span>
</code></pre>
</div>

<h1 id="showing-specific-nodes---it-dept">Showing specific nodes - IT Dept.</h1>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span>      <span class="n">employee_ID</span><span class="p">,</span> <span class="n">manager_ID</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">department_id</span>
<span class="k">FROM</span>        <span class="n">employee2</span>
<span class="k">WHERE</span> <span class="n">department_ID</span> <span class="o">=</span> <span class="mi">60</span>
<span class="k">START</span> <span class="k">WITH</span>  <span class="n">employee_ID</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">CONNECT</span> <span class="k">BY</span> <span class="k">PRIOR</span> <span class="n">employee_ID</span> <span class="o">=</span> <span class="n">manager_ID</span><span class="p">;</span>
</code></pre>
</div>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Dario Alessandro Lencina-Talarico</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              Dario Alessandro Lencina-Talarico
            
            </li>
            
            <li><a href="mailto:darioalessandrolencina@gmail.com">darioalessandrolencina@gmail.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/darioalessandro"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">darioalessandro</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/darioalessandro"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">darioalessandro</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Blog written by Dario Alessandro Lencina-Talarico about technology and stuff.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
